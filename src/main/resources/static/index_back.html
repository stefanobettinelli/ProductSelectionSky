<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sky Product Selection</title>
    <script src="https://fb.me/react-15.0.1.js"></script>
    <script src="https://fb.me/react-dom-15.0.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="/styles/style.css"/>
</head>
<body>
<div class='container'>
    <div id='root'></div>
</div>


<script type="text/babel">

    var App = React.createClass({
        loadCustomerIdFromServer: function () {
            var self = this;
            $.ajax({
                url: "http://localhost:8080/customer_locations/1"
            }).then(function (data) {
                self.setState({customerLocation: data});
            });
        },

        loadProductsFromServer: function () {
            var self = this;
            $.ajax({
                url: "http://localhost:8080/catalogue/1"
            }).then(function (data) {
                self.setState({availableProducts: data});
            });
        },

        getInitialState: function () {
            return {customerLocation: ""};
        },

        componentDidMount: function () {
            this.loadCustomerIdFromServer();
            this.loadProductsFromServer();
        },

        render(){
            var id = this.state.customerLocation.id;
            var customerLoc = this.state.customerLocation;
            var products = this.state.availableProducts;

            console.log(customerLoc);
            console.log(products);
            return <SportProductList products={PRODUCTS}/>;
        }

    });


    var SportProductList = React.createClass({
        render: function () {
            var productCollection = [];
            var sportsProducts = [];
            var newsProducts = [];
            this.props.products.forEach(function (productsCategory) {
                //productCollection.push(<Product product={product}/>);
                //sportsProducts.push(<Product product={category}/>);
                if (productsCategory.category === "sports") {
                    sportsProducts = Array.from(productsCategory.products);
                }
                if (productsCategory.category === "news") {
                    newsProducts = Array.from(productsCategory.products);
                }
            });
            var productList = sportsProducts.map((product) =>
                    <li key={product.toString()}>
                        <label>
                            <input type="checkbox"/> {product}
                        </label>
                    </li>
            );
            return (
                    <div id="checkboxes">
                        <lh><h3>Products</h3></lh>
                        <ul>{productList}</ul>
                    </div>
            );
        }
    });

    var PRODUCTS = [
        {category: "sports", products: ['Arsenal TV', 'Chelsea TV', 'Liverpool TV']},
        {category: "news", products: ['Sky news', 'Sky sports']}
    ];

    ReactDOM.render(<App />, document.getElementById('root'));

</script>
</body>
</html>